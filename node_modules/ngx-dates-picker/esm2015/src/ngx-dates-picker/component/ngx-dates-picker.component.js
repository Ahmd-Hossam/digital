var NgxDatesPickerComponent_1;
import { __decorate } from "tslib";
import { Component, Input, HostListener, forwardRef, ViewChild } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { startOfMonth, endOfMonth, addMonths, subMonths, setYear, eachDayOfInterval, getDate, getMonth, getYear, isToday, isSameMonth, format, getDay, subDays, setDay, isAfter, isBefore, addDays, setMonth, } from 'date-fns';
import { isSameDate, createDateRange } from '../helpers';
// Counter for calculating the auto-incrementing field ID
let counter = 0;
/**
 * Internal library helper that helps to check if value is empty
 * @param value
 */
const isNil = (value) => {
    return (typeof value === 'undefined') || (value === null);
};
const Éµ0 = isNil;
let NgxDatesPickerComponent = NgxDatesPickerComponent_1 = class NgxDatesPickerComponent {
    constructor() {
        /**
         * Disable datepicker's input
         */
        this.headless = false;
        /**
         * Set datepicker's visibility state
         */
        this.isOpened = false;
        /**
         * Datepicker dropdown position
         */
        this.position = 'bottom-right';
        this.currentOptions = {
            closeOnClickOutside: true,
            closeOnSelection: true,
            includeDays: 'previous-month',
            includeNextMonthsFirstFullWeek: false,
            minYear: 1970,
            maxYear: 2030,
            displayFormat: 'MMM dd, yyyy',
            barTitleFormat: 'MMMM yyyy',
            dayNamesFormat: 'EEE',
            rangeSeparator: '-',
            selectRange: false,
            firstCalendarDay: 0,
            barTitleIfEmpty: 'Click to select a date',
            locale: {},
            placeholder: '',
            addClass: {},
            addStyle: {},
            fieldId: this.defaultFieldId,
            useEmptyBarTitle: true,
        };
        this.onTouchedCallback = () => { };
        this.onChangeCallback = () => { };
        this.formatDay = (date, isVisible = true) => ({
            date: date,
            day: getDate(date),
            month: getMonth(date),
            year: getYear(date),
            inThisMonth: isSameMonth(date, this.viewingDate),
            isToday: isVisible && isToday(date),
            isSelected: isVisible && this.isDateSelected(date),
            isInRange: isVisible && this.isInRange(date),
            isSelectable: isVisible && this.isDateSelectable(date),
            isStart: isVisible && this.isRangeBoundary(date, 'start'),
            isEnd: isVisible && this.isRangeBoundary(date, 'end'),
            isVisible,
        });
        this.scrollOptions = {
            barBackground: '#DFE3E9',
            gridBackground: '#FFFFFF',
            barBorderRadius: '3',
            gridBorderRadius: '3',
            barWidth: '6',
            gridWidth: '6',
            barMargin: '0',
            gridMargin: '0'
        };
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    set range(val) {
        this._range = val;
        this.onChangeCallback(this.getValueToEmit(val));
    }
    get range() {
        return this._range;
    }
    ngOnInit() {
        this.view = 'days';
        this.range = {
            start: new Date(),
            end: new Date(),
        };
        this.viewingDate = new Date();
        this.initDayNames();
        this.initYears();
        this.initMonths();
    }
    ngOnChanges(changes) {
        if ('options' in changes) {
            this.updateOptions(changes.options.currentValue);
            this.initDayNames();
            this.init();
            this.initYears();
            this.initMonths();
        }
    }
    get defaultFieldId() {
        // Only evaluate and increment if required
        const value = `datepicker-${counter++}`;
        Object.defineProperty(this, 'defaultFieldId', { value });
        return value;
    }
    updateOptions(options) {
        this.currentOptions = Object.assign(Object.assign({}, this.currentOptions), options);
    }
    nextMonth() {
        this.viewingDate = addMonths(this.viewingDate, 1);
        this.init();
    }
    prevMonth() {
        this.viewingDate = subMonths(this.viewingDate, 1);
        this.init();
    }
    setDate(i) {
        const date = this.days[i].date;
        if (this.currentOptions.selectRange) {
            if (!this.range.start && !this.range.end) {
                this.range.start = date;
            }
            else if (this.range.start && !this.range.end && isAfter(date, this.range.start)) {
                this.range.end = date;
            }
            else {
                this.range.end = undefined;
                this.range.start = date;
            }
        }
        else {
            this.range.start = this.range.end = date;
        }
        this.init();
        this.onChangeCallback(this.getValueToEmit(this.range));
        if (this.currentOptions.closeOnSelection && this.range.end) {
            this.close();
        }
    }
    setYear(i) {
        this.viewingDate = setYear(this.viewingDate, this.years[i].year);
        this.init();
        this.initYears();
        this.view = 'months';
    }
    setMonth(i) {
        this.viewingDate = setMonth(this.viewingDate, this.months[i].month);
        this.init();
        this.initMonths();
        this.view = 'days';
    }
    init() {
        if (!this.viewingDate) {
            return;
        }
        const start = startOfMonth(this.viewingDate);
        const end = endOfMonth(this.viewingDate);
        this.days = eachDayOfInterval({ start, end }).map((date) => this.formatDay(date));
        const firstMonthDay = getDay(start) - this.currentOptions.firstCalendarDay;
        const prevDays = firstMonthDay < 0 ? 7 - this.currentOptions.firstCalendarDay : firstMonthDay;
        let nextDays = (this.currentOptions.firstCalendarDay === 1 ? 7 : 6) - getDay(end);
        const showPrevMonthDays = this.currentOptions.includeDays === 'all' || this.currentOptions.includeDays === 'previous-month';
        const showNextMonthDays = this.currentOptions.includeDays === 'all' || this.currentOptions.includeDays === 'next-month';
        if (showNextMonthDays && this.currentOptions.includeNextMonthsFirstFullWeek) {
            nextDays += 7;
        }
        for (let i = 1; i <= prevDays; i++) {
            this.days.unshift(this.formatDay(subDays(start, i), showPrevMonthDays));
        }
        new Array(nextDays).fill(undefined)
            .forEach((_, i) => this.days.push(this.formatDay(addDays(end, i + 1), showNextMonthDays)));
        this.displayValue = this.formatDisplay();
        if (this.range) {
            this.barTitle = format(this.viewingDate, this.currentOptions.barTitleFormat, this.currentOptions.locale);
        }
        else {
            this.barTitle = this.currentOptions.useEmptyBarTitle ?
                this.currentOptions.barTitleIfEmpty :
                format(this.viewingDate, this.currentOptions.barTitleFormat, this.currentOptions.locale);
        }
    }
    initYears() {
        const range = this.currentOptions.maxYear - this.currentOptions.minYear;
        this.years = Array.from(new Array(range), (x, i) => i + this.currentOptions.minYear).map((year) => {
            return { year: year, isThisYear: year === getYear(this.viewingDate) };
        });
    }
    initMonths() {
        this.months = Array.from(new Array(12), (x, i) => setMonth(new Date(), i + 1))
            .map((date) => {
            return { month: date.getMonth(), name: format(date, 'MMM'), isSelected: date.getMonth() === getMonth(this.viewingDate) };
        });
    }
    initDayNames() {
        this.dayNames = [];
        const start = this.currentOptions.firstCalendarDay;
        for (let i = start; i <= 6 + start; i++) {
            const date = setDay(new Date(), i);
            this.dayNames.push(format(date, this.currentOptions.dayNamesFormat, this.currentOptions.locale));
        }
    }
    toggleView() {
        this.view = this.view === 'days' ? 'years' : 'days';
    }
    toggle() {
        this.isOpened = !this.isOpened;
        if (!this.isOpened && this.view === 'years') {
            this.toggleView();
        }
    }
    close() {
        this.isOpened = false;
        if (this.view === 'years') {
            this.toggleView();
        }
    }
    reset() {
        this.range = {
            start: new Date(),
            end: new Date(),
        };
        this.init();
    }
    writeValue(val) {
        if (val) {
            if (typeof val === 'string') {
                this.range.start = this.range.end = new Date(val);
            }
            else if (val instanceof Date) {
                this.range.start = this.range.end = val;
            }
            else if (val.start) { // Checking if it's instance of DateRange
                this.range = val;
            }
            else {
                throw Error('Invalid input data type');
            }
            this.viewingDate = this.range.start || this.viewingDate;
            this.init();
        }
    }
    registerOnChange(fn) {
        this.onChangeCallback = fn;
    }
    registerOnTouched(fn) {
        this.onTouchedCallback = fn;
    }
    onBlur(e) {
        if (!this.isOpened || !this.currentOptions.closeOnClickOutside) {
            return;
        }
        if (this.inputElement == null) {
            return;
        }
        if (e.target === this.inputElement.nativeElement ||
            this.inputElement.nativeElement.contains(e.target) ||
            (e.target.parentElement && e.target.parentElement.classList.contains('day-unit'))) {
            return;
        }
        if (this.calendarContainerElement.nativeElement !== e.target &&
            !this.calendarContainerElement.nativeElement.contains(e.target) &&
            !e.target.classList.contains('year-unit') &&
            !e.target.classList.contains('month-unit')) {
            this.close();
        }
    }
    getDayClasses(day) {
        return {
            'is-prev-month': !day.inThisMonth,
            'is-today': day.isToday,
            'is-selected': day.isSelected,
            'is-in-range': day.isInRange,
            'is-disabled': !day.isSelectable,
            'range-start': day.isStart,
            'range-end': day.isEnd,
            'is-visible': day.isVisible,
        };
    }
    /**
     * Checks if specified date is in range of min and max dates
     * @param date
     */
    isDateSelectable(date) {
        const minDateSet = !isNil(this.currentOptions.minDate);
        const maxDateSet = !isNil(this.currentOptions.maxDate);
        const timestamp = date.valueOf();
        return (!(minDateSet && timestamp < this.currentOptions.minDate.valueOf()) ||
            (!(maxDateSet && timestamp > this.currentOptions.maxDate.valueOf())));
    }
    isDateSelected(date) {
        return isSameDate(date, this.range.start) || isSameDate(date, this.range.end);
    }
    isInRange(date) {
        return this.isDateSelected(date) || (isAfter(date, this.range.start) && isBefore(date, this.range.end));
    }
    formatDisplay() {
        if (!this.range) {
            return '';
        }
        const formattedStartDate = format(this.range.start, this.currentOptions.displayFormat, this.currentOptions.locale);
        if (this.currentOptions.selectRange) {
            const formattedEndDate = format(this.range.end || this.range.start, this.currentOptions.displayFormat, this.currentOptions.locale);
            return `${formattedStartDate}${this.currentOptions.rangeSeparator}${formattedEndDate}`;
        }
        return formattedStartDate;
    }
    isRangeBoundary(date, boundary) {
        return !this.range[boundary] || isSameDate(date, this.range[boundary]);
    }
    getValueToEmit(range) {
        if (!this.currentOptions.selectRange) {
            return new Date(range.start.getTime());
        }
        if (range.end) {
            return createDateRange(range.start, range.end);
        }
        return createDateRange(range.start, range.start);
    }
};
__decorate([
    ViewChild('container')
], NgxDatesPickerComponent.prototype, "calendarContainerElement", void 0);
__decorate([
    ViewChild('inputElement')
], NgxDatesPickerComponent.prototype, "inputElement", void 0);
__decorate([
    Input()
], NgxDatesPickerComponent.prototype, "options", void 0);
__decorate([
    Input()
], NgxDatesPickerComponent.prototype, "headless", void 0);
__decorate([
    Input()
], NgxDatesPickerComponent.prototype, "isOpened", void 0);
__decorate([
    Input()
], NgxDatesPickerComponent.prototype, "position", void 0);
__decorate([
    Input()
], NgxDatesPickerComponent.prototype, "previousMonthButtonTemplate", void 0);
__decorate([
    Input()
], NgxDatesPickerComponent.prototype, "nextMonthButtonTemplate", void 0);
__decorate([
    HostListener('document:click', ['$event'])
], NgxDatesPickerComponent.prototype, "onBlur", null);
NgxDatesPickerComponent = NgxDatesPickerComponent_1 = __decorate([
    Component({
        selector: 'ngx-dates-picker',
        template: "<div class=\"ngx-dates-picker-container\">\n  <input *ngIf=\"!headless\"\n         #inputElement\n         type=\"text\"\n         class=\"ngx-dates-picker-input\"\n         [(ngModel)]=\"displayValue\"\n         readonly\n         [placeholder]=\"currentOptions.placeholder\"\n         [ngClass]=\"currentOptions.addClass\"\n         [ngStyle]=\"currentOptions.addStyle\"\n         [id]=\"fieldId\"\n         [disabled]=\"disabled\"\n         (click)=\"toggle()\" />\n  <ng-content></ng-content>\n  <div class=\"ngx-dates-picker-calendar-container ngx-dates-picker-position-{{position}}\"\n       *ngIf=\"isOpened\"\n       #container>\n    <div class=\"topbar-container\">\n      <div (click)=\"prevMonth()\">\n        <ng-template [ngTemplateOutlet]=\"previousMonthButtonTemplate || defaultPreviousMonthTemplate\"></ng-template>\n      </div>\n      <ng-template #defaultPreviousMonthTemplate>\n        <svg width=\"7px\"\n             height=\"10px\"\n             viewBox=\"0 0 7 10\"\n             version=\"1.1\"\n             xmlns=\"http://www.w3.org/2000/svg\"\n             xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n          <g stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n            <g transform=\"translate(-923.000000, -1882.000000)\" fill=\"#CED0DA\">\n              <g transform=\"translate(80.000000, 1361.000000)\">\n                <g transform=\"translate(0.000000, 430.000000)\">\n                  <g transform=\"translate(825.000000, 0.000000)\">\n                    <g transform=\"translate(0.000000, 72.000000)\">\n                      <g transform=\"translate(18.000000, 15.000000)\">\n                        <polygon id=\"Back\" points=\"6.015 4 0 9.013 6.015 14.025\"></polygon>\n                      </g>\n                    </g>\n                  </g>\n                </g>\n              </g>\n            </g>\n          </g>\n        </svg>\n      </ng-template>\n      <span class=\"topbar-title\" (click)=\"toggleView()\">{{ barTitle }}</span>\n      <div (click)=\"nextMonth()\">\n        <ng-template [ngTemplateOutlet]=\"nextMonthButtonTemplate || defaultNextMonthTemplate\"></ng-template>\n      </div>\n      <ng-template #defaultNextMonthTemplate>\n        <svg width=\"7px\"\n             height=\"10px\"\n             viewBox=\"0 0 6 10\"\n             version=\"1.1\"\n             xmlns=\"http://www.w3.org/2000/svg\"\n             xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n          <g id=\"Source-Sans---UI-Elements-Kit\" stroke=\"none\" stroke-width=\"1\" fill=\"none\" fill-rule=\"evenodd\">\n            <g id=\"White-Layout\" transform=\"translate(-1182.000000, -1882.000000)\" fill=\"#CED0DA\">\n              <g id=\"Dropdowns-&amp;-Selector\" transform=\"translate(80.000000, 1361.000000)\">\n                <g id=\"Dropdowns\" transform=\"translate(0.000000, 430.000000)\">\n                  <g id=\"Calendar\" transform=\"translate(825.000000, 0.000000)\">\n                    <g transform=\"translate(0.000000, 72.000000)\" id=\"Top-Bar-Nav\">\n                      <g transform=\"translate(18.000000, 15.000000)\">\n                        <polygon id=\"Forward\"\n                                 transform=\"translate(262.007500, 9.012500) scale(-1, 1) translate(-262.007500, -9.012500) \"\n                                 points=\"265.015 4 259 9.013 265.015 14.025\">\n                        </polygon>\n                      </g>\n                    </g>\n                  </g>\n                </g>\n              </g>\n            </g>\n          </g>\n        </svg>\n      </ng-template>\n    </div>\n    <div class=\"main-calendar-container\">\n      <ng-container *ngIf=\"view === 'days'\">\n        <div class=\"main-calendar-day-names\">\n          <span class=\"day-name-unit\" *ngFor=\"let name of dayNames\">{{ name }}</span>\n        </div>\n        <div class=\"main-calendar-days\">\n          <span class=\"day-unit\"\n                *ngFor=\"let day of days; let i = index;\"\n                (click)=\"day.isSelectable && setDate(i)\">\n            <span class=\"day-background-upper\"\n                  [ngClass]=\"this.getDayClasses(day)\">{{ day.isVisible ? day.day : '' }}</span>\n            <span class=\"day-background-lower\"\n                  [ngClass]=\"this.getDayClasses(day)\"></span>\n          </span>\n        </div>\n      </ng-container>\n      <div *ngIf=\"view === 'years'\">\n        <div class=\"main-calendar-years\" slimScroll [options]=\"scrollOptions\">\n          <span *ngFor=\"let year of years; let i = index;\"\n                class=\"year-unit\"\n                [ngClass]=\"{ 'is-selected': year.isThisYear }\"\n                (click)=\"setYear(i)\"\n          >\n            {{ year.year }}\n          </span>\n        </div>\n        </div>\n      <div *ngIf=\"view === 'months'\" class=\"main-calendar-months\">\n        <span *ngFor=\"let month of months; let i = index;\"\n              class=\"month-unit\"\n              [ngClass]=\"{ 'is-selected': month.isSelected}\"\n              (click)=\"setMonth(i)\"\n        >\n          {{ month.name }}\n        </span>\n      </div>\n    </div>\n  </div>\n</div>\n",
        providers: [
            { provide: NG_VALUE_ACCESSOR, useExisting: forwardRef(() => NgxDatesPickerComponent_1), multi: true }
        ],
        styles: [".ngx-dates-picker-position-bottom-left{top:40px;right:0}.ngx-dates-picker-position-bottom-right{top:40px;left:0}.ngx-dates-picker-position-top-left{bottom:40px;right:0}.ngx-dates-picker-position-top-right{bottom:40px;left:0}.ngx-dates-picker-position-static{position:static!important}.ngx-dates-picker-container{position:relative}.ngx-dates-picker-input{padding:5px 10px;font-size:14px;width:200px;outline:0;border:1px solid #dfe3e9}.ngx-dates-picker-calendar-container{position:absolute;width:300px;background:#fff;box-shadow:0 1px 4px 0 rgba(0,0,0,.08);border:1px solid #dfe3e9;border-radius:4px}.topbar-container{width:100%;height:50px;padding:0 15px;border-bottom:1px solid #dfe3e9;display:flex;justify-content:space-between;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.topbar-container svg{cursor:pointer}.topbar-container svg g{fill:#ced0da}.topbar-container div{cursor:pointer}.topbar-title{color:#3d495c;font-size:14px;font-weight:600;cursor:pointer}.main-calendar-container{width:100%;height:100%;padding:15px 10px 0;font-size:12px;font-weight:500}.main-calendar-day-names{color:#cbcbcb;width:100%;display:flex;align-items:center}.day-name-unit{width:calc(100% / 7);text-transform:uppercase;text-align:center}.main-calendar-days,.main-calendar-years{padding:15px 0 0;width:100%;display:inline-block;overflow:hidden}.day-unit,.month-unit,.year-unit{position:relative;width:calc(100% / 7);font-size:14px;font-weight:400;height:40px;display:inline-flex;float:left;align-items:center;justify-content:center;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.day-background-upper{display:inline-flex;position:absolute;z-index:1;width:100%;height:100%;border-radius:50%;align-items:center;justify-content:center}.day-background-upper.is-selected{background:#0186ff;color:#fff}.day-background-upper:not(.is-visible){cursor:default}.day-background-upper.is-visible:hover{background:#f0f0f0;color:#000}.day-background-upper.is-visible.is-prev-month{color:#cbcbcb}.day-background-upper.is-visible.is-disabled{cursor:not-allowed;color:#cbcbcb}.day-background-lower{display:inline-flex;position:absolute;z-index:0;width:100%;height:100%;align-items:center;justify-content:center;border-top:2px solid #fff;border-bottom:2px solid #fff}.day-background-lower.is-in-range{background:rgba(1,134,255,.1)}.day-background-lower.range-start{border-bottom-left-radius:50%;border-top-left-radius:50%}.day-background-lower.range-end{border-bottom-right-radius:50%;border-top-right-radius:50%}.main-calendar-years{height:210px;display:block;padding:0}.month-unit{width:calc(100% / 4);height:54px}.year-unit{width:calc(100% / 3)}.month-unit,.year-unit{border-radius:10px}.month-unit.is-selected,.year-unit.is-selected{background:#0186ff;color:#fff}.month-unit:hover,.year-unit:hover{background:#f0f0f0;color:#000}.main-calendar-months{padding-bottom:10px;display:inline-block}"]
    })
], NgxDatesPickerComponent);
export { NgxDatesPickerComponent };
export { Éµ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmd4LWRhdGVzLXBpY2tlci5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZ3gtZGF0ZXMtcGlja2VyLyIsInNvdXJjZXMiOlsic3JjL25neC1kYXRlcy1waWNrZXIvY29tcG9uZW50L25neC1kYXRlcy1waWNrZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsT0FBTyxFQUNMLFNBQVMsRUFFVCxLQUFLLEVBSUwsWUFBWSxFQUNaLFVBQVUsRUFDVixTQUFTLEVBRVYsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGlCQUFpQixFQUF3QixNQUFNLGdCQUFnQixDQUFDO0FBQ3pFLE9BQU8sRUFDTCxZQUFZLEVBQ1osVUFBVSxFQUNWLFNBQVMsRUFDVCxTQUFTLEVBQ1QsT0FBTyxFQUNQLGlCQUFpQixFQUNqQixPQUFPLEVBQ1AsUUFBUSxFQUNSLE9BQU8sRUFDUCxPQUFPLEVBQ1AsV0FBVyxFQUNYLE1BQU0sRUFDTixNQUFNLEVBQ04sT0FBTyxFQUNQLE1BQU0sRUFDTixPQUFPLEVBQUUsUUFBUSxFQUFFLE9BQU8sRUFBRSxRQUFRLEdBQ3JDLE1BQU0sVUFBVSxDQUFDO0FBRWxCLE9BQU8sRUFBRSxVQUFVLEVBQUUsZUFBZSxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBb0N6RCx5REFBeUQ7QUFDekQsSUFBSSxPQUFPLEdBQUcsQ0FBQyxDQUFDO0FBRWhCOzs7R0FHRztBQUNILE1BQU0sS0FBSyxHQUFHLENBQUMsS0FBK0IsRUFBRSxFQUFFO0lBQ2hELE9BQU8sQ0FBQyxPQUFPLEtBQUssS0FBSyxXQUFXLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxJQUFJLENBQUMsQ0FBQztBQUM1RCxDQUFDLENBQUM7O0FBVUYsSUFBYSx1QkFBdUIsK0JBQXBDLE1BQWEsdUJBQXVCO0lBNkVsQztRQXZFQTs7V0FFRztRQUNNLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFFMUI7O1dBRUc7UUFDTSxhQUFRLEdBQUcsS0FBSyxDQUFD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ZW50LFxuICBPbkluaXQsXG4gIElucHV0LFxuICBPbkNoYW5nZXMsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIEVsZW1lbnRSZWYsXG4gIEhvc3RMaXN0ZW5lcixcbiAgZm9yd2FyZFJlZixcbiAgVmlld0NoaWxkLFxuICBUZW1wbGF0ZVJlZlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IE5HX1ZBTFVFX0FDQ0VTU09SLCBDb250cm9sVmFsdWVBY2Nlc3NvciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7XG4gIHN0YXJ0T2ZNb250aCxcbiAgZW5kT2ZNb250aCxcbiAgYWRkTW9udGhzLFxuICBzdWJNb250aHMsXG4gIHNldFllYXIsXG4gIGVhY2hEYXlPZkludGVydmFsLFxuICBnZXREYXRlLFxuICBnZXRNb250aCxcbiAgZ2V0WWVhcixcbiAgaXNUb2RheSxcbiAgaXNTYW1lTW9udGgsXG4gIGZvcm1hdCxcbiAgZ2V0RGF5LFxuICBzdWJEYXlzLFxuICBzZXREYXksXG4gIGlzQWZ0ZXIsIGlzQmVmb3JlLCBhZGREYXlzLCBzZXRNb250aCxcbn0gZnJvbSAnZGF0ZS1mbnMnO1xuaW1wb3J0IHsgSVNsaW1TY3JvbGxPcHRpb25zIH0gZnJvbSAnbmd4LXNsaW1zY3JvbGwnO1xuaW1wb3J0IHsgaXNTYW1lRGF0ZSwgY3JlYXRlRGF0ZVJhbmdlIH0gZnJvbSAnLi4vaGVscGVycyc7XG5pbXBvcnQgeyBEYXRlUmFuZ2UsIERheSB9IGZyb20gJy4uL21vZGVscyc7XG5cbmV4cG9ydCB0eXBlIEFkZENsYXNzID0gc3RyaW5nIHwgc3RyaW5nW10gfCB7IFtrOiBzdHJpbmddOiBib29sZWFuIH0gfCBudWxsO1xuXG5leHBvcnQgaW50ZXJmYWNlIERhdGVwaWNrZXJPcHRpb25zIHtcbiAgY2xvc2VPbkNsaWNrT3V0c2lkZT86IGJvb2xlYW47XG4gIGNsb3NlT25TZWxlY3Rpb24/OiBib29sZWFuO1xuICBpbmNsdWRlRGF5cz86ICdub25lJyB8ICdwcmV2aW91cy1tb250aCcgfCAnbmV4dC1tb250aCcgfCAnYWxsJztcbiAgaW5jbHVkZU5leHRNb250aHNGaXJzdEZ1bGxXZWVrPzogYm9vbGVhbjtcbiAgbWluWWVhcj86IG51bWJlcjsgLy8gZGVmYXVsdDogY3VycmVudCB5ZWFyIC0gMzBcbiAgbWF4WWVhcj86IG51bWJlcjsgLy8gZGVmYXVsdDogY3VycmVudCB5ZWFyICsgMzBcbiAgZGlzcGxheUZvcm1hdD86IHN0cmluZzsgLy8gZGVmYXVsdDogJ01NTSBEWyxdIFlZWVknXG4gIGJhclRpdGxlRm9ybWF0Pzogc3RyaW5nOyAvLyBkZWZhdWx0OiAnTU1NTSBZWVlZJ1xuICBkYXlOYW1lc0Zvcm1hdD86IHN0cmluZzsgLy8gZGVmYXVsdCAnZGRkJ1xuICBiYXJUaXRsZUlmRW1wdHk/OiBzdHJpbmc7XG4gIHNlbGVjdFJhbmdlPzogYm9vbGVhbjtcbiAgcmFuZ2VTZXBhcmF0b3I/OiBzdHJpbmc7IC8vIGRlZmF1bHQgJy0nXG4gIGZpcnN0Q2FsZW5kYXJEYXk/OiBudW1iZXI7IC8vIDAgPSBTdW5kYXkgKGRlZmF1bHQpLCAxID0gTW9uZGF5LCAuLlxuICBsb2NhbGU/OiBvYmplY3Q7XG4gIG1pbkRhdGU/OiBEYXRlO1xuICBtYXhEYXRlPzogRGF0ZTtcbiAgLyoqIFBsYWNlaG9sZGVyIGZvciB0aGUgaW5wdXQgZmllbGQgKi9cbiAgcGxhY2Vob2xkZXI/OiBzdHJpbmc7XG4gIC8qKiBbbmdDbGFzc10gdG8gYWRkIHRvIHRoZSBpbnB1dCBmaWVsZCAqL1xuICBhZGRDbGFzcz86IEFkZENsYXNzO1xuICAvKiogW25nU3R5bGVdIHRvIGFkZCB0byB0aGUgaW5wdXQgZmllbGQgKi9cbiAgYWRkU3R5bGU/OiB7IFtrOiBzdHJpbmddOiBhbnkgfSB8IG51bGw7XG4gIC8qKiBJRCB0byBhc3NpZ24gdG8gdGhlIGlucHV0IGZpZWxkICovXG4gIGZpZWxkSWQ/OiBzdHJpbmc7XG4gIC8qKiBJZiBmYWxzZSwgYmFyVGl0bGVJZkVtcHR5IHdpbGwgYmUgZGlzcmVnYXJkZWQgYW5kIGEgZGF0ZSB3aWxsIGFsd2F5cyBiZSBzaG93bi4gRGVmYXVsdDogdHJ1ZSAqL1xuICB1c2VFbXB0eUJhclRpdGxlPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IHR5cGUgUGlja2VyUG9zaXRpb24gPSAnYm90dG9tLWxlZnQnIHwgJ2JvdHRvbS1yaWdodCcgfCAndG9wLWxlZnQnIHwgJ3RvcC1yaWdodCcgfCAnc3RhdGljJztcblxuLy8gQ291bnRlciBmb3IgY2FsY3VsYXRpbmcgdGhlIGF1dG8taW5jcmVtZW50aW5nIGZpZWxkIElEXG5sZXQgY291bnRlciA9IDA7XG5cbi8qKlxuICogSW50ZXJuYWwgbGlicmFyeSBoZWxwZXIgdGhhdCBoZWxwcyB0byBjaGVjayBpZiB2YWx1ZSBpcyBlbXB0eVxuICogQHBhcmFtIHZhbHVlXG4gKi9cbmNvbnN0IGlzTmlsID0gKHZhbHVlOiBEYXRlIHwgRGF0ZXBpY2tlck9wdGlvbnMpID0+IHtcbiAgcmV0dXJuICh0eXBlb2YgdmFsdWUgPT09ICd1bmRlZmluZWQnKSB8fCAodmFsdWUgPT09IG51bGwpO1xufTtcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LWRhdGVzLXBpY2tlcicsXG4gIHRlbXBsYXRlVXJsOiAnbmd4LWRhdGVzLXBpY2tlci5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWyduZ3gtZGF0ZXMtcGlja2VyLmNvbXBvbmVudC5zYXNzJ10sXG4gIHByb3ZpZGVyczogW1xuICAgIHsgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IE5neERhdGVzUGlja2VyQ29tcG9uZW50KSwgbXVsdGk6IHRydWUgfVxuICBdXG59KVxuZXhwb3J0IGNsYXNzIE5neERhdGVzUGlja2VyQ29tcG9uZW50IGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE9uSW5pdCwgT25DaGFuZ2VzIHtcbiAgQFZpZXdDaGlsZCgnY29udGFpbmVyJykgY2FsZW5kYXJDb250YWluZXJFbGVtZW50OiBFbGVtZW50UmVmO1xuICBAVmlld0NoaWxkKCdpbnB1dEVsZW1lbnQnKSBpbnB1dEVsZW1lbnQ6IEVsZW1lbnRSZWY7XG5cbiAgQElucHV0KCkgb3B0aW9uczogRGF0ZXBpY2tlck9wdGlvbnM7XG5cbiAgLyoqXG4gICAqIERpc2FibGUgZGF0ZXBpY2tlcidzIGlucHV0XG4gICAqL1xuICBASW5wdXQoKSBoZWFkbGVzcyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBTZXQgZGF0ZXBpY2tlcidzIHZpc2liaWxpdHkgc3RhdGVcbiAgICovXG4gIEBJbnB1dCgpIGlzT3BlbmVkID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIERhdGVwaWNrZXIgZHJvcGRvd24gcG9zaXRpb25cbiAgICovXG4gIEBJbnB1dCgpIHBvc2l0aW9uOiBQaWNrZXJQb3NpdGlvbiA9ICdib3R0b20tcmlnaHQnO1xuXG4gIEBJbnB1dCgpIHByZXZpb3VzTW9udGhCdXR0b25UZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PjtcbiAgQElucHV0KCkgbmV4dE1vbnRoQnV0dG9uVGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgY3VycmVudE9wdGlvbnM6IERhdGVwaWNrZXJPcHRpb25zID0ge1xuICAgIGNsb3NlT25DbGlja091dHNpZGU6IHRydWUsXG4gICAgY2xvc2VPblNlbGVjdGlvbjogdHJ1ZSxcbiAgICBpbmNsdWRlRGF5czogJ3ByZXZpb3VzLW1vbnRoJyxcbiAgICBpbmNsdWRlTmV4dE1vbnRoc0ZpcnN0RnVsbFdlZWs6IGZhbHNlLFxuICAgIG1pblllYXI6IDE5NzAsXG4gICAgbWF4WWVhcjogMjAzMCxcbiAgICBkaXNwbGF5Rm9ybWF0OiAnTU1NIGRkLCB5eXl5JyxcbiAgICBiYXJUaXRsZUZvcm1hdDogJ01NTU0geXl5eScsXG4gICAgZGF5TmFtZXNGb3JtYXQ6ICdFRUUnLFxuICAgIHJhbmdlU2VwYXJhdG9yOiAnLScsXG4gICAgc2VsZWN0UmFuZ2U6IGZhbHNlLFxuICAgIGZpcnN0Q2FsZW5kYXJEYXk6IDAsXG4gICAgYmFyVGl0bGVJZkVtcHR5OiAnQ2xpY2sgdG8gc2VsZWN0IGEgZGF0ZScsXG4gICAgbG9jYWxlOiB7fSxcbiAgICBwbGFjZWhvbGRlcjogJycsXG4gICAgYWRkQ2xhc3M6IHt9LFxuICAgIGFkZFN0eWxlOiB7fSxcbiAgICBmaWVsZElkOiB0aGlzLmRlZmF1bHRGaWVsZElkLFxuICAgIHVzZUVtcHR5QmFyVGl0bGU6IHRydWUsXG4gIH07XG5cbiAgZGlzcGxheVZhbHVlOiBzdHJpbmc7XG4gIHZpZXdpbmdEYXRlOiBEYXRlO1xuICBiYXJUaXRsZTogc3RyaW5nO1xuICB2aWV3OiAnZGF5cycgfCAnbW9udGhzJyB8ICd5ZWFycyc7XG4gIHllYXJzOiB7IHllYXI6IG51bWJlcjsgaXNUaGlzWWVhcjogYm9vbGVhbiB9W107XG4gIG1vbnRoczogeyBtb250aDogbnVtYmVyOyBuYW1lOiBzdHJpbmc7IGlzU2VsZWN0ZWQ6IGJvb2xlYW4gfVtdO1xuICBkYXlOYW1lczogc3RyaW5nW107XG4gIHNjcm9sbE9wdGlvbnM6IElTbGltU2Nyb2xsT3B0aW9ucztcbiAgZGF5czogRGF5W107XG4gIGZpZWxkSWQ6IHN0cmluZztcbiAgZGlzYWJsZWQ6IGJvb2xlYW47XG5cbiAgcHJpdmF0ZSBfcmFuZ2U6IERhdGVSYW5nZTtcblxuICBwcml2YXRlIG9uVG91Y2hlZENhbGxiYWNrOiAoKSA9PiB2b2lkID0gKCkgPT4geyB9O1xuICBwcml2YXRlIG9uQ2hhbmdlQ2FsbGJhY2s6IChfOiBhbnkpID0+IHZvaWQgPSAoKSA9PiB7IH07XG5cbiAgcHVibGljIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZDogYm9vbGVhbikge1xuICAgIHRoaXMuZGlzYWJsZWQgPSBpc0Rpc2FibGVkO1xuICB9XG5cbiAgc2V0IHJhbmdlKHZhbDogRGF0ZVJhbmdlIHwgdW5kZWZpbmVkKSB7XG4gICAgdGhpcy5fcmFuZ2UgPSB2YWw7XG5cbiAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2sodGhpcy5nZXRWYWx1ZVRvRW1pdCh2YWwpKTtcbiAgfVxuXG4gIGdldCByYW5nZSgpOiBEYXRlUmFuZ2UgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLl9yYW5nZTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuc2Nyb2xsT3B0aW9ucyA9IHtcbiAgICAgIGJhckJhY2tncm91bmQ6ICcjREZFM0U5JyxcbiAgICAgIGdyaWRCYWNrZ3JvdW5kOiAnI0ZGRkZGRicsXG4gICAgICBiYXJCb3JkZXJSYWRpdXM6ICczJyxcbiAgICAgIGdyaWRCb3JkZXJSYWRpdXM6ICczJyxcbiAgICAgIGJhcldpZHRoOiAnNicsXG4gICAgICBncmlkV2lkdGg6ICc2JyxcbiAgICAgIGJhck1hcmdpbjogJzAnLFxuICAgICAgZ3JpZE1hcmdpbjogJzAnXG4gICAgfTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMudmlldyA9ICdkYXlzJztcbiAgICB0aGlzLnJhbmdlID0ge1xuICAgICAgc3RhcnQ6IG5ldyBEYXRlKCksXG4gICAgICBlbmQ6IG5ldyBEYXRlKCksXG4gICAgfTtcbiAgICB0aGlzLnZpZXdpbmdEYXRlID0gbmV3IERhdGUoKTtcblxuICAgIHRoaXMuaW5pdERheU5hbWVzKCk7XG4gICAgdGhpcy5pbml0WWVhcnMoKTtcbiAgICB0aGlzLmluaXRNb250aHMoKTtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcbiAgICBpZiAoJ29wdGlvbnMnIGluIGNoYW5nZXMpIHtcbiAgICAgIHRoaXMudXBkYXRlT3B0aW9ucyhjaGFuZ2VzLm9wdGlvbnMuY3VycmVudFZhbHVlKTtcbiAgICAgIHRoaXMuaW5pdERheU5hbWVzKCk7XG4gICAgICB0aGlzLmluaXQoKTtcbiAgICAgIHRoaXMuaW5pdFllYXJzKCk7XG4gICAgICB0aGlzLmluaXRNb250aHMoKTtcbiAgICB9XG4gIH1cblxuICBnZXQgZGVmYXVsdEZpZWxkSWQoKTogc3RyaW5nIHtcbiAgICAvLyBPbmx5IGV2YWx1YXRlIGFuZCBpbmNyZW1lbnQgaWYgcmVxdWlyZWRcbiAgICBjb25zdCB2YWx1ZSA9IGBkYXRlcGlja2VyLSR7Y291bnRlcisrfWA7XG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICdkZWZhdWx0RmllbGRJZCcsIHt2YWx1ZX0pO1xuXG4gICAgcmV0dXJuIHZhbHVlO1xuICB9XG5cbiAgdXBkYXRlT3B0aW9ucyhvcHRpb25zOiBEYXRlcGlja2VyT3B0aW9ucyk6IHZvaWQge1xuICAgIHRoaXMuY3VycmVudE9wdGlvbnMgPSB7XG4gICAgICAuLi50aGlzLmN1cnJlbnRPcHRpb25zLFxuICAgICAgLi4ub3B0aW9ucyxcbiAgICB9O1xuICB9XG5cbiAgbmV4dE1vbnRoKCk6IHZvaWQge1xuICAgIHRoaXMudmlld2luZ0RhdGUgPSBhZGRNb250aHModGhpcy52aWV3aW5nRGF0ZSwgMSk7XG4gICAgdGhpcy5pbml0KCk7XG4gIH1cblxuICBwcmV2TW9udGgoKTogdm9pZCB7XG4gICAgdGhpcy52aWV3aW5nRGF0ZSA9IHN1Yk1vbnRocyh0aGlzLnZpZXdpbmdEYXRlLCAxKTtcbiAgICB0aGlzLmluaXQoKTtcbiAgfVxuXG4gIHNldERhdGUoaTogbnVtYmVyKTogdm9pZCB7XG4gICAgY29uc3QgZGF0ZSA9IHRoaXMuZGF5c1tpXS5kYXRlO1xuXG4gICAgaWYgKHRoaXMuY3VycmVudE9wdGlvbnMuc2VsZWN0UmFuZ2UpIHtcbiAgICAgIGlmICghdGhpcy5yYW5nZS5zdGFydCAmJiAhdGhpcy5yYW5nZS5lbmQpIHtcbiAgICAgICAgdGhpcy5yYW5nZS5zdGFydCA9IGRhdGU7XG4gICAgICB9IGVsc2UgaWYgKHRoaXMucmFuZ2Uuc3RhcnQgJiYgIXRoaXMucmFuZ2UuZW5kICYmIGlzQWZ0ZXIoZGF0ZSwgdGhpcy5yYW5nZS5zdGFydCkpIHtcbiAgICAgICAgdGhpcy5yYW5nZS5lbmQgPSBkYXRlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5yYW5nZS5lbmQgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMucmFuZ2Uuc3RhcnQgPSBkYXRlO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJhbmdlLnN0YXJ0ID0gdGhpcy5yYW5nZS5lbmQgPSBkYXRlO1xuICAgIH1cblxuICAgIHRoaXMuaW5pdCgpO1xuICAgIHRoaXMub25DaGFuZ2VDYWxsYmFjayh0aGlzLmdldFZhbHVlVG9FbWl0KHRoaXMucmFuZ2UpKTtcblxuICAgIGlmICh0aGlzLmN1cnJlbnRPcHRpb25zLmNsb3NlT25TZWxlY3Rpb24gJiYgdGhpcy5yYW5nZS5lbmQpIHtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBzZXRZZWFyKGk6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMudmlld2luZ0RhdGUgPSBzZXRZZWFyKHRoaXMudmlld2luZ0RhdGUsIHRoaXMueWVhcnNbaV0ueWVhcik7XG4gICAgdGhpcy5pbml0KCk7XG4gICAgdGhpcy5pbml0WWVhcnMoKTtcbiAgICB0aGlzLnZpZXcgPSAnbW9udGhzJztcbiAgfVxuXG4gIHNldE1vbnRoKGk6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMudmlld2luZ0RhdGUgPSBzZXRNb250aCh0aGlzLnZpZXdpbmdEYXRlLCB0aGlzLm1vbnRoc1tpXS5tb250aCk7XG4gICAgdGhpcy5pbml0KCk7XG4gICAgdGhpcy5pbml0TW9udGhzKCk7XG4gICAgdGhpcy52aWV3ID0gJ2RheXMnO1xuICB9XG5cbiAgaW5pdCgpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMudmlld2luZ0RhdGUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBzdGFydCA9IHN0YXJ0T2ZNb250aCh0aGlzLnZpZXdpbmdEYXRlKTtcbiAgICBjb25zdCBlbmQgPSBlbmRPZk1vbnRoKHRoaXMudmlld2luZ0RhdGUpO1xuXG4gICAgdGhpcy5kYXlzID0gZWFjaERheU9mSW50ZXJ2YWwoeyBzdGFydCwgZW5kIH0pLm1hcCgoZGF0ZSkgPT4gdGhpcy5mb3JtYXREYXkoZGF0ZSkpO1xuXG4gICAgY29uc3QgZmlyc3RNb250aERheSA9IGdldERheShzdGFydCkgLSB0aGlzLmN1cnJlbnRPcHRpb25zLmZpcnN0Q2FsZW5kYXJEYXk7XG4gICAgY29uc3QgcHJldkRheXMgPSBmaXJzdE1vbnRoRGF5IDwgMCA/IDcgLSB0aGlzLmN1cnJlbnRPcHRpb25zLmZpcnN0Q2FsZW5kYXJEYXkgOiBmaXJzdE1vbnRoRGF5O1xuICAgIGxldCBuZXh0RGF5cyA9ICh0aGlzLmN1cnJlbnRPcHRpb25zLmZpcnN0Q2FsZW5kYXJEYXkgPT09IDEgPyA3IDogNikgLSBnZXREYXkoZW5kKTtcblxuICAgIGNvbnN0IHNob3dQcmV2TW9udGhEYXlzID0gdGhpcy5jdXJyZW50T3B0aW9ucy5pbmNsdWRlRGF5cyA9PT0gJ2FsbCcgfHwgdGhpcy5jdXJyZW50T3B0aW9ucy5pbmNsdWRlRGF5cyA9PT0gJ3ByZXZpb3VzLW1vbnRoJztcbiAgICBjb25zdCBzaG93TmV4dE1vbnRoRGF5cyA9IHRoaXMuY3VycmVudE9wdGlvbnMuaW5jbHVkZURheXMgPT09ICdhbGwnIHx8IHRoaXMuY3VycmVudE9wdGlvbnMuaW5jbHVkZURheXMgPT09ICduZXh0LW1vbnRoJztcblxuICAgIGlmIChzaG93TmV4dE1vbnRoRGF5cyAmJiB0aGlzLmN1cnJlbnRPcHRpb25zLmluY2x1ZGVOZXh0TW9udGhzRmlyc3RGdWxsV2Vlaykge1xuICAgICAgbmV4dERheXMgKz0gNztcbiAgICB9XG5cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSBwcmV2RGF5czsgaSsrKSB7XG4gICAgICB0aGlzLmRheXMudW5zaGlmdCh0aGlzLmZvcm1hdERheShzdWJEYXlzKHN0YXJ0LCBpKSwgc2hvd1ByZXZNb250aERheXMpKTtcbiAgICB9XG5cbiAgICBuZXcgQXJyYXkobmV4dERheXMpLmZpbGwodW5kZWZpbmVkKVxuICAgICAgLmZvckVhY2goKF8sIGkpID0+IHRoaXMuZGF5cy5wdXNoKHRoaXMuZm9ybWF0RGF5KGFkZERheXMoZW5kLCBpICsgMSksIHNob3dOZXh0TW9udGhEYXlzKSkpO1xuXG5cbiAgICB0aGlzLmRpc3BsYXlWYWx1ZSA9IHRoaXMuZm9ybWF0RGlzcGxheSgpO1xuXG4gICAgaWYgKHRoaXMucmFuZ2UpIHtcbiAgICAgIHRoaXMuYmFyVGl0bGUgPSBmb3JtYXQodGhpcy52aWV3aW5nRGF0ZSwgdGhpcy5jdXJyZW50T3B0aW9ucy5iYXJUaXRsZUZvcm1hdCwgdGhpcy5jdXJyZW50T3B0aW9ucy5sb2NhbGUpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmJhclRpdGxlID0gdGhpcy5jdXJyZW50T3B0aW9ucy51c2VFbXB0eUJhclRpdGxlID9cbiAgICAgICAgdGhpcy5jdXJyZW50T3B0aW9ucy5iYXJUaXRsZUlmRW1wdHkgOlxuICAgICAgICBmb3JtYXQodGhpcy52aWV3aW5nRGF0ZSwgdGhpcy5jdXJyZW50T3B0aW9ucy5iYXJUaXRsZUZvcm1hdCwgdGhpcy5jdXJyZW50T3B0aW9ucy5sb2NhbGUpO1xuICAgIH1cbiAgfVxuXG4gIGluaXRZZWFycygpOiB2b2lkIHtcbiAgICBjb25zdCByYW5nZSA9IHRoaXMuY3VycmVudE9wdGlvbnMubWF4WWVhciAtIHRoaXMuY3VycmVudE9wdGlvbnMubWluWWVhcjtcblxuICAgIHRoaXMueWVhcnMgPSBBcnJheS5mcm9tKG5ldyBBcnJheShyYW5nZSksICh4LCBpKSA9PiBpICsgdGhpcy5jdXJyZW50T3B0aW9ucy5taW5ZZWFyKS5tYXAoKHllYXIpID0+IHtcbiAgICAgIHJldHVybiB7IHllYXI6IHllYXIsIGlzVGhpc1llYXI6IHllYXIgPT09IGdldFllYXIodGhpcy52aWV3aW5nRGF0ZSkgfTtcbiAgICB9KTtcbiAgfVxuXG4gIGluaXRNb250aHMoKTogdm9pZCB7XG4gICAgdGhpcy5tb250aHMgPSBBcnJheS5mcm9tKG5ldyBBcnJheSgxMiksICh4LCBpKSA9PiBzZXRNb250aChuZXcgRGF0ZSgpLCBpICsgMSkpXG4gICAgICAubWFwKChkYXRlKSA9PiB7XG4gICAgICAgIHJldHVybiB7IG1vbnRoOiBkYXRlLmdldE1vbnRoKCksIG5hbWU6IGZvcm1hdChkYXRlLCAnTU1NJyksIGlzU2VsZWN0ZWQ6IGRhdGUuZ2V0TW9udGgoKSA9PT0gZ2V0TW9udGgodGhpcy52aWV3aW5nRGF0ZSkgfTtcbiAgICAgIH0pO1xuICB9XG5cbiAgaW5pdERheU5hbWVzKCk6IHZvaWQge1xuICAgIHRoaXMuZGF5TmFtZXMgPSBbXTtcbiAgICBjb25zdCBzdGFydCA9IHRoaXMuY3VycmVudE9wdGlvbnMuZmlyc3RDYWxlbmRhckRheTtcblxuICAgIGZvciAobGV0IGkgPSBzdGFydDsgaSA8PSA2ICsgc3RhcnQ7IGkrKykge1xuICAgICAgY29uc3QgZGF0ZSA9IHNldERheShuZXcgRGF0ZSgpLCBpKTtcblxuICAgICAgdGhpcy5kYXlOYW1lcy5wdXNoKGZvcm1hdChkYXRlLCB0aGlzLmN1cnJlbnRPcHRpb25zLmRheU5hbWVzRm9ybWF0LCB0aGlzLmN1cnJlbnRPcHRpb25zLmxvY2FsZSkpO1xuICAgIH1cbiAgfVxuXG4gIHRvZ2dsZVZpZXcoKTogdm9pZCB7XG4gICAgdGhpcy52aWV3ID0gdGhpcy52aWV3ID09PSAnZGF5cycgPyAneWVhcnMnIDogJ2RheXMnO1xuICB9XG5cbiAgdG9nZ2xlKCk6IHZvaWQge1xuICAgIHRoaXMuaXNPcGVuZWQgPSAhdGhpcy5pc09wZW5lZDtcblxuICAgIGlmICghdGhpcy5pc09wZW5lZCAmJiB0aGlzLnZpZXcgPT09ICd5ZWFycycpIHtcbiAgICAgIHRoaXMudG9nZ2xlVmlldygpO1xuICAgIH1cbiAgfVxuXG4gIGNsb3NlKCk6IHZvaWQge1xuICAgIHRoaXMuaXNPcGVuZWQgPSBmYWxzZTtcblxuICAgIGlmICh0aGlzLnZpZXcgPT09ICd5ZWFycycpIHtcbiAgICAgIHRoaXMudG9nZ2xlVmlldygpO1xuICAgIH1cbiAgfVxuXG4gIHJlc2V0KCk6IHZvaWQge1xuICAgIHRoaXMucmFuZ2UgPSB7XG4gICAgICBzdGFydDogbmV3IERhdGUoKSxcbiAgICAgIGVuZDogbmV3IERhdGUoKSxcbiAgICB9O1xuICAgIHRoaXMuaW5pdCgpO1xuICB9XG5cbiAgd3JpdGVWYWx1ZSh2YWw6IERhdGVSYW5nZSB8IERhdGUgfCBzdHJpbmcgfCB1bmRlZmluZWQpIHtcbiAgICBpZiAodmFsKSB7XG4gICAgICBpZiAodHlwZW9mIHZhbCA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgdGhpcy5yYW5nZS5zdGFydCA9IHRoaXMucmFuZ2UuZW5kID0gbmV3IERhdGUodmFsKTtcbiAgICAgIH0gZWxzZSBpZiAodmFsIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICB0aGlzLnJhbmdlLnN0YXJ0ID0gdGhpcy5yYW5nZS5lbmQgPSB2YWw7XG4gICAgICB9IGVsc2UgaWYgKHZhbC5zdGFydCkgeyAvLyBDaGVja2luZyBpZiBpdCdzIGluc3RhbmNlIG9mIERhdGVSYW5nZVxuICAgICAgICB0aGlzLnJhbmdlID0gdmFsO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgRXJyb3IoJ0ludmFsaWQgaW5wdXQgZGF0YSB0eXBlJyk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMudmlld2luZ0RhdGUgPSB0aGlzLnJhbmdlLnN0YXJ0IHx8IHRoaXMudmlld2luZ0RhdGU7XG5cbiAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cbiAgfVxuXG4gIHJlZ2lzdGVyT25DaGFuZ2UoZm46IGFueSkge1xuICAgIHRoaXMub25DaGFuZ2VDYWxsYmFjayA9IGZuO1xuICB9XG5cbiAgcmVnaXN0ZXJPblRvdWNoZWQoZm46IGFueSkge1xuICAgIHRoaXMub25Ub3VjaGVkQ2FsbGJhY2sgPSBmbjtcbiAgfVxuXG4gIEBIb3N0TGlzdGVuZXIoJ2RvY3VtZW50OmNsaWNrJywgWyckZXZlbnQnXSkgb25CbHVyKGU6IE1vdXNlRXZlbnQpIHtcbiAgICBpZiAoIXRoaXMuaXNPcGVuZWQgfHwgIXRoaXMuY3VycmVudE9wdGlvbnMuY2xvc2VPbkNsaWNrT3V0c2lkZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmlucHV0RWxlbWVudCA9PSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGUudGFyZ2V0ID09PSB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50IHx8XG4gICAgICB0aGlzLmlucHV0RWxlbWVudC5uYXRpdmVFbGVtZW50LmNvbnRhaW5zKDxhbnk+ZS50YXJnZXQpIHx8XG4gICAgICAoKDxhbnk+ZS50YXJnZXQpLnBhcmVudEVsZW1lbnQgJiYgKDxhbnk+ZS50YXJnZXQpLnBhcmVudEVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdkYXktdW5pdCcpKVxuICAgICkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmNhbGVuZGFyQ29udGFpbmVyRWxlbWVudC5uYXRpdmVFbGVtZW50ICE9PSBlLnRhcmdldCAmJlxuICAgICAgIXRoaXMuY2FsZW5kYXJDb250YWluZXJFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuY29udGFpbnMoPGFueT5lLnRhcmdldCkgJiZcbiAgICAgICEoPGFueT5lLnRhcmdldCkuY2xhc3NMaXN0LmNvbnRhaW5zKCd5ZWFyLXVuaXQnKSAmJlxuICAgICAgISg8YW55PmUudGFyZ2V0KS5jbGFzc0xpc3QuY29udGFpbnMoJ21vbnRoLXVuaXQnKVxuICAgICkge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH1cbiAgfVxuXG5cbiAgZm9ybWF0RGF5ID0gKGRhdGU6IERhdGUsIGlzVmlzaWJsZTogYm9vbGVhbiA9IHRydWUpOiBEYXkgPT4gKFxuICAgIHtcbiAgICAgIGRhdGU6IGRhdGUsXG4gICAgICBkYXk6IGdldERhdGUoZGF0ZSksXG4gICAgICBtb250aDogZ2V0TW9udGgoZGF0ZSksXG4gICAgICB5ZWFyOiBnZXRZZWFyKGRhdGUpLFxuICAgICAgaW5UaGlzTW9udGg6IGlzU2FtZU1vbnRoKGRhdGUsIHRoaXMudmlld2luZ0RhdGUpLFxuICAgICAgaXNUb2RheTogaXNWaXNpYmxlICYmIGlzVG9kYXkoZGF0ZSksXG4gICAgICBpc1NlbGVjdGVkOiBpc1Zpc2libGUgJiYgdGhpcy5pc0RhdGVTZWxlY3RlZChkYXRlKSxcbiAgICAgIGlzSW5SYW5nZTogaXNWaXNpYmxlICYmIHRoaXMuaXNJblJhbmdlKGRhdGUpLFxuICAgICAgaXNTZWxlY3RhYmxlOiBpc1Zpc2libGUgJiYgdGhpcy5pc0RhdGVTZWxlY3RhYmxlKGRhdGUpLFxuICAgICAgaXNTdGFydDogaXNWaXNpYmxlICYmIHRoaXMuaXNSYW5nZUJvdW5kYXJ5KGRhdGUsICdzdGFydCcpLFxuICAgICAgaXNFbmQ6IGlzVmlzaWJsZSAmJiB0aGlzLmlzUmFuZ2VCb3VuZGFyeShkYXRlLCAnZW5kJyksXG4gICAgICBpc1Zpc2libGUsXG4gICAgfVxuICApXG5cbiAgZ2V0RGF5Q2xhc3NlcyhkYXk6IERheSk6IEFkZENsYXNzIHtcbiAgICByZXR1cm4ge1xuICAgICAgJ2lzLXByZXYtbW9udGgnOiAhZGF5LmluVGhpc01vbnRoLFxuICAgICAgJ2lzLXRvZGF5JzogZGF5LmlzVG9kYXksXG4gICAgICAnaXMtc2VsZWN0ZWQnOiBkYXkuaXNTZWxlY3RlZCxcbiAgICAgICdpcy1pbi1yYW5nZSc6IGRheS5pc0luUmFuZ2UsXG4gICAgICAnaXMtZGlzYWJsZWQnOiAhZGF5LmlzU2VsZWN0YWJsZSxcbiAgICAgICdyYW5nZS1zdGFydCc6IGRheS5pc1N0YXJ0LFxuICAgICAgJ3JhbmdlLWVuZCc6IGRheS5pc0VuZCxcbiAgICAgICdpcy12aXNpYmxlJzogZGF5LmlzVmlzaWJsZSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiBzcGVjaWZpZWQgZGF0ZSBpcyBpbiByYW5nZSBvZiBtaW4gYW5kIG1heCBkYXRlc1xuICAgKiBAcGFyYW0gZGF0ZVxuICAgKi9cbiAgcHJpdmF0ZSBpc0RhdGVTZWxlY3RhYmxlKGRhdGU6IERhdGUpOiBib29sZWFuIHtcbiAgICBjb25zdCBtaW5EYXRlU2V0ID0gIWlzTmlsKHRoaXMuY3VycmVudE9wdGlvbnMubWluRGF0ZSk7XG4gICAgY29uc3QgbWF4RGF0ZVNldCA9ICFpc05pbCh0aGlzLmN1cnJlbnRPcHRpb25zLm1heERhdGUpO1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IGRhdGUudmFsdWVPZigpO1xuXG4gICAgcmV0dXJuICghKG1pbkRhdGVTZXQgJiYgdGltZXN0YW1wIDwgdGhpcy5jdXJyZW50T3B0aW9ucy5taW5EYXRlLnZhbHVlT2YoKSkgfHxcbiAgICAgICghKG1heERhdGVTZXQgJiYgdGltZXN0YW1wID4gdGhpcy5jdXJyZW50T3B0aW9ucy5tYXhEYXRlLnZhbHVlT2YoKSkpKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNEYXRlU2VsZWN0ZWQoZGF0ZTogRGF0ZSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBpc1NhbWVEYXRlKGRhdGUsIHRoaXMucmFuZ2Uuc3RhcnQpIHx8IGlzU2FtZURhdGUoZGF0ZSwgdGhpcy5yYW5nZS5lbmQpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0luUmFuZ2UoZGF0ZTogRGF0ZSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmlzRGF0ZVNlbGVjdGVkKGRhdGUpIHx8IChpc0FmdGVyKGRhdGUsIHRoaXMucmFuZ2Uuc3RhcnQpICYmIGlzQmVmb3JlKGRhdGUsIHRoaXMucmFuZ2UuZW5kKSk7XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdERpc3BsYXkoKTogc3RyaW5nIHtcbiAgICBpZiAoIXRoaXMucmFuZ2UpIHtcbiAgICAgIHJldHVybiAnJztcbiAgICB9XG5cbiAgICBjb25zdCBmb3JtYXR0ZWRTdGFydERhdGUgPSBmb3JtYXQodGhpcy5yYW5nZS5zdGFydCwgdGhpcy5jdXJyZW50T3B0aW9ucy5kaXNwbGF5Rm9ybWF0LCB0aGlzLmN1cnJlbnRPcHRpb25zLmxvY2FsZSk7XG5cbiAgICBpZiAodGhpcy5jdXJyZW50T3B0aW9ucy5zZWxlY3RSYW5nZSkge1xuICAgICAgY29uc3QgZm9ybWF0dGVkRW5kRGF0ZSA9IGZvcm1hdChcbiAgICAgICAgdGhpcy5yYW5nZS5lbmQgfHwgdGhpcy5yYW5nZS5zdGFydCxcbiAgICAgICAgdGhpcy5jdXJyZW50T3B0aW9ucy5kaXNwbGF5Rm9ybWF0LFxuICAgICAgICB0aGlzLmN1cnJlbnRPcHRpb25zLmxvY2FsZVxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIGAke2Zvcm1hdHRlZFN0YXJ0RGF0ZX0ke3RoaXMuY3VycmVudE9wdGlvbnMucmFuZ2VTZXBhcmF0b3J9JHtmb3JtYXR0ZWRFbmREYXRlfWA7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZvcm1hdHRlZFN0YXJ0RGF0ZTtcbiAgfVxuXG4gIHByaXZhdGUgaXNSYW5nZUJvdW5kYXJ5KGRhdGU6IERhdGUsIGJvdW5kYXJ5OiAnc3RhcnQnIHwgJ2VuZCcpOiBib29sZWFuIHtcbiAgICByZXR1cm4gIXRoaXMucmFuZ2VbYm91bmRhcnldIHx8IGlzU2FtZURhdGUoZGF0ZSwgdGhpcy5yYW5nZVtib3VuZGFyeV0pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRWYWx1ZVRvRW1pdChyYW5nZTogRGF0ZVJhbmdlKTogRGF0ZVJhbmdlIHwgRGF0ZSB7XG4gICAgaWYgKCF0aGlzLmN1cnJlbnRPcHRpb25zLnNlbGVjdFJhbmdlKSB7XG4gICAgICByZXR1cm4gbmV3IERhdGUocmFuZ2Uuc3RhcnQuZ2V0VGltZSgpKTtcbiAgICB9XG5cbiAgICBpZiAocmFuZ2UuZW5kKSB7XG4gICAgICByZXR1cm4gY3JlYXRlRGF0ZVJhbmdlKHJhbmdlLnN0YXJ0LCByYW5nZS5lbmQpO1xuICAgIH1cblxuICAgIHJldHVybiBjcmVhdGVEYXRlUmFuZ2UocmFuZ2Uuc3RhcnQsIHJhbmdlLnN0YXJ0KTtcbiAgfVxufVxuIl19